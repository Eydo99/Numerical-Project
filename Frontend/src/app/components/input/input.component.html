<div class="input-panel">

  <!-- HEADER -->
  <div class="panel-header">
    <h2 class="title">Target Function</h2>
  </div>

  <!-- DISPLAY -->

  <button *ngIf="selectedMethod === 'fixed-point'"
          class="toggle-edit-main"
          [class.active]="editingTarget === 'fx'"
          (click)="editingTarget = 'fx'">
    Edit f(x)
  </button>

  <div class="display-box" (click)="setCaretFromClick($event)">
    <span class="fx-label">{{ editingTarget === 'fx' ? 'f(x) =' : 'g(x) =' }}</span>
    <div class="fx-value-wrapper">
      <span class="fx-value">
        {{ getBeforeCursor() }}<span class="cursor-blink">|</span>{{ getAfterCursor() }}
      </span>
    </div>
  </div>

  <!-- NAV ROW: left/right, AC, DEL -->
  <div class="nav-row">
    <button class="small" (click)="moveLeft()">◀</button>
    <button class="small" (click)="moveRight()">▶</button>

    <!-- parentheses here -->
    <button class="small" (click)="insert('(')">(</button>
    <button class="small" (click)="insert(')')">)</button>

    <button class="small danger" (click)="clearAll()">AC</button>
    <button class="small danger" (click)="deleteBefore()">DEL</button>
  </div>


  <!-- NUMPAD grid - x is at position 15 (where = was) -->
  <div class="numpad">
    <button *ngFor="let b of numpad" (click)="insert(b.token)">
      {{ b.label }}
    </button>
  </div>


  <!-- Category tabs - NO 'Var' here -->
  <div class="categories">
    <button *ngFor="let c of categories"
            (click)="activeCategory = c"
            [class.active]="activeCategory === c">
      {{ c }}
    </button>
  </div>

  <!-- Category panels -->
  <div class="category-panel">

    <!-- TRIG -->
    <div *ngIf="activeCategory === 'Trig'" class="button-grid">
      <button *ngFor="let b of trigButtons" (click)="insert(b.token)">{{ b.label }}</button>
    </div>

    <!-- HYP -->
    <div *ngIf="activeCategory === 'Hyp'" class="button-grid">
      <button *ngFor="let b of hypButtons" (click)="insert(b.token)">{{ b.label }}</button>
    </div>

    <!-- POWERS -->
    <div *ngIf="activeCategory === 'Powers'" class="button-grid">
      <button *ngFor="let b of powerButtons" (click)="insert(b.token)">{{ b.label }}</button>
    </div>

    <!-- LOG -->
    <div *ngIf="activeCategory === 'Log'" class="button-grid">
      <button *ngFor="let b of logButtons" (click)="insert(b.token)">{{ b.label }}</button>
    </div>

    <!-- FRACTIONS -->
    <div *ngIf="activeCategory === 'Fractions'" class="button-grid">
      <button *ngFor="let b of fractionButtons" (click)="insert(b.token)">{{ b.label }}</button>
    </div>

    <!-- ROOTS -->
    <div *ngIf="activeCategory === 'Roots'" class="button-grid">
      <button *ngFor="let b of rootsButtons" (click)="insert(b.token)">{{ b.label }}</button>
    </div>

    <!-- CONST -->
    <div *ngIf="activeCategory === 'Const'" class="button-grid">
      <button *ngFor="let b of constButtons" (click)="insert(b.token)">{{ b.label }}</button>
    </div>

  </div>

  <!-- GENERAL SETTINGS -->
  <h3 class="section-title">General Settings</h3>
  <div class="settings-header">
    <button class="clear-all-btn" (click)="clearAllSettings()">
      <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
      </svg>
      Clear All
    </button>
  </div>
  <div class="settings-grid">
    <label>Max Iterations
      <input type="number" [(ngModel)]="maxIterations" min="1" />
    </label>

    <label>Tolerance (ε)
      <input type="text" [(ngModel)]="tolerance" />
    </label>

    <label>Sig. Figures
      <input type="number" [(ngModel)]="significantFigures" min="0" />
    </label>
  </div>

  <!-- PLOT SETTINGS -->
  <h3 class="section-title">Plot Settings</h3>
  <div class="settings-grid">
    <label>Plot Start
      <input type="number" [(ngModel)]="plotStart" />
    </label>

    <label>Plot End
      <input type="number" [(ngModel)]="plotEnd" />
    </label>
  </div>

  <div class="run-row" style="margin-top: 12px;">
    <button
      class="plot-btn"
      (click)="plotFunction()"
      [disabled]="isPlotting || !fx">
      <svg *ngIf="!isPlotting" class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"></path>
      </svg>
      <svg *ngIf="isPlotting" class="btn-icon animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
      </svg>
      {{ isPlotting ? 'PLOTTING...' : 'PLOT FUNCTION' }}
    </button>
  </div>

  <!-- METHOD PARAMETERS (conditional) -->
  <h3 class="section-title">Method Parameters</h3>
  <div class="method-params">

    <!-- Bisection & False-Position -->
    <div *ngIf="selectedMethod === 'bisection' || selectedMethod === 'false-position'">
      <label>Start (a)<input type="number" [(ngModel)]="startA" /></label>
      <label>End (b)<input type="number" [(ngModel)]="endB" /></label>
    </div>

    <!-- Fixed Point -->
    <div *ngIf="selectedMethod === 'fixed-point'" style="width: 100%;">
      <label>Initial x₀<input type="number" [(ngModel)]="initialX" /></label>


      <div class="gx-row">
        <button class="toggle-edit"
                [class.active]="editingTarget === 'gx'"
                (click)="toggleEditing()">
          {{ editingTarget === 'gx' ? 'Editing g(x)' : 'Edit g(x)' }}
        </button>
      </div>
    </div>

    <!-- Newton Original -->
    <div *ngIf="selectedMethod === 'newton-orig'">
      <label>Initial x₀<input type="number" [(ngModel)]="newtonX" /></label>
    </div>

    <!-- Modified Newton -->
    <div *ngIf="selectedMethod === 'newton-mod'" class="input-group">
      <label>Initial X
        <input type="number" [(ngModel)]="modifiedX" />
      </label>

      <label>Multiplicity (optional)
        <input type="number"
               class="wide-input"
               [(ngModel)]="modifiedY"
               placeholder="Empty for modified 2 newton" />
      </label>
    </div>

    <!-- Secant -->
    <div *ngIf="selectedMethod === 'secant'">
      <label>x₀<input type="number" [(ngModel)]="secantX0" /></label>
      <label>x₁<input type="number" [(ngModel)]="secantX1" /></label>
    </div>
  </div>

  <div class="run-row">
    <button class="run-btn" (click)="runMethod()">RUN METHOD</button>
  </div>
</div>
