<!--button-->
            <button
              (click)="openSimulator()"
              *ngIf="shouldShowSimulatorButton()"
              [disabled]="!steps || steps.length === 0"
              class="w-full bg-gradient-to-r from-amber-500 to-orange-500 text-white py-3 rounded-xl font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"
                ></path>
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                ></path>
              </svg>
              {{ steps && steps.length > 0 ? 'Simulate Solution Steps' : 'No Steps Available' }}
            </button>

<div *ngIf="showSimulator && steps && steps.length > 0" class="mt-6">
  <div
    class="bg-gradient-to-br from-indigo-50 to-purple-50 border-2 border-indigo-200 rounded-xl p-6"
  >
    <!-- Header -->
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-lg font-semibold text-slate-800 flex items-center gap-2">
        <svg class="w-5 h-5 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
          ></path>
        </svg>
        Solution Steps
      </h3>

      <div class="flex items-center gap-3">
        <!-- Step counter -->
        <div class="bg-white px-4 py-2 rounded-lg border border-indigo-300 shadow-sm">
          <span class="text-sm font-medium text-slate-600">
            Step
            <span class="text-indigo-600 font-bold">{{ (currentStepIndex$ | async)! + 1 }}</span>
            of <span class="text-slate-800 font-bold">{{ steps.length }}</span>
          </span>
        </div>

        <!-- Close button -->
        <button
          (click)="closeSimulator()"
          class="p-2 bg-red-100 hover:bg-red-200 rounded-lg transition-colors"
          title="Close simulator"
        >
          <svg class="w-5 h-5 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"
            ></path>
          </svg>
        </button>
      </div>
    </div>

    <!-- Current Step Display -->
    <div class="bg-white rounded-xl p-6 mb-4 border-2 border-indigo-100">
      <div class="flex items-center gap-2 mb-3">
        <div
          class="w-8 h-8 bg-indigo-600 rounded-full flex items-center justify-center text-white font-bold text-sm"
        >
          {{ (currentStepIndex$ | async)! + 1 }}
        </div>
        <h4 class="text-md font-semibold text-slate-800">
          {{ shouldShowMatrix() ? 'Step' : 'Iteration' }}
          {{ (currentStepIndex$ | async)! + 1 }}
        </h4>
      </div>
      <!-- values-->
      <div
        *ngIf="getCurrentStep()"
        class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4"
      >
        <h5 class="text-sm font-semibold text-slate-700 mb-3">
          {{ shouldShowMatrix() ? 'Current Solution:' : 'Iteration Values:' }}
        </h5>
        <div class="flex flex-wrap gap-3 items-center justify-center">
          <div
            *ngFor="let val of getCurrentStep()!.answers; let i = index"
            class="flex items-baseline gap-2 bg-white px-3 py-2 rounded-lg shadow-sm"
          >
            <span class="text-indigo-700 font-semibold">
              x<sub class="text-xs">{{ i + 1 }}</sub>
            </span>
            <span class="text-indigo-500 font-bold">=</span>
            <span class="text-indigo-900 font-bold text-lg">
              {{ val }}
            </span>
          </div>
        </div>
      </div>

      <!-- Matrix Display (for Gauss and Gauss-Jordan) -->
      <div *ngIf="shouldShowMatrix() && getCurrentStep()?.matrix" class="mb-4">
        <h5 class="text-sm font-semibold text-slate-700 mb-2">Augmented Matrix:</h5>
        <div class="bg-slate-50 rounded-lg p-4 overflow-x-auto">
          <div class="inline-block">
            <div
              *ngFor="let row of getCurrentStep()!.matrix; let i = index"
              class="flex gap-2 mb-2"
            >
              <div
                *ngFor="let cell of row; let j = index"
                [class]="
                  j === row.length - 1
                    ? 'w-20 px-3 py-2 bg-green-100 border-2 border-green-300 rounded text-center font-mono text-sm'
                    : 'w-20 px-3 py-2 bg-white border-2 border-slate-300 rounded text-center font-mono text-sm'
                "
              >
                {{ cell.toFixed(4) }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="shouldShowLU() && getCurrentStep()?.L && getCurrentStep()?.U" class="mb-6">
        <h5 class="text-sm font-semibold text-slate-700 mb-3">L &amp; U Matrices:</h5>

        <div class="flex gap-10 bg-slate-50 rounded-lg p-5 overflow-x-auto">
          <!-- L Matrix -->
          <div>
            <h6 class="text-xs font-bold text-slate-600 mb-2 text-center">L Matrix</h6>
            <div class="inline-block">
              <div *ngFor="let row of getCurrentStep()!.L" class="flex gap-2 mb-2">
                <div
                  *ngFor="let cell of row"
                  class="w-20 px-3 py-2 bg-white border-2 border-slate-300 rounded text-center font-mono text-sm"
                >
                  {{ cell.toFixed(4) }}
                </div>
              </div>
            </div>
          </div>

          <!-- U Matrix -->
          <div>
            <h6 class="text-xs font-bold text-slate-600 mb-2 text-center">U Matrix</h6>
            <div class="inline-block">
              <div *ngFor="let row of getCurrentStep()!.U" class="flex gap-2 mb-2">
                <div
                  *ngFor="let cell of row"
                  class="w-20 px-3 py-2 bg-white border-2 border-slate-300 rounded text-center font-mono text-sm"
                >
                  {{ cell.toFixed(4) }}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="space-y-4">
        <!-- Playback Controls -->
        <div class="space-y-4">
          <!-- Main Controls -->
          <div class="flex items-center justify-center gap-2">
            <!-- First -->
            <button
              (click)="resetSimulation()"
              [disabled]="(currentStepIndex$ | async) === 0"
              class="p-2 bg-white border-2 border-slate-300 rounded-lg hover:bg-slate-50 transition-colors disabled:opacity-30 disabled:cursor-not-allowed"
              title="First step"
            >
              <svg
                class="w-5 h-5 text-slate-700"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M11 19l-7-7 7-7m8 14l-7-7 7-7"
                ></path>
              </svg>
            </button>

            <!-- Previous -->
            <button
              (click)="previousStep()"
              [disabled]="(currentStepIndex$ | async) === 0"
              class="p-3 bg-white border-2 border-slate-300 rounded-lg hover:bg-slate-50 transition-colors disabled:opacity-30 disabled:cursor-not-allowed"
              title="Previous step"
            >
              <svg
                class="w-6 h-6 text-slate-700"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 19l-7-7 7-7"
                ></path>
              </svg>
            </button>

            <!-- Play/Pause -->
            <button
              *ngIf="!(isPlaying$ | async)"
              (click)="playSimulation()"
              [disabled]="(currentStepIndex$ | async) === steps.length - 1"
              class="p-4 bg-gradient-to-r from-indigo-600 to-blue-600 rounded-xl hover:shadow-lg transition-all disabled:opacity-30 disabled:cursor-not-allowed"
              title="Play"
            >
              <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24">
                <path d="M8 5v14l11-7z"></path>
              </svg>
            </button>

            <button
              *ngIf="isPlaying$ | async"
              (click)="pauseSimulation()"
              class="p-4 bg-gradient-to-r from-orange-600 to-red-600 rounded-xl hover:shadow-lg transition-all"
              title="Pause"
            >
              <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24">
                <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"></path>
              </svg>
            </button>

            <!-- Next -->
            <button
              (click)="nextStep()"
              [disabled]="(currentStepIndex$ | async) === steps.length - 1"
              class="p-3 bg-white border-2 border-slate-300 rounded-lg hover:bg-slate-50 transition-colors disabled:opacity-30 disabled:cursor-not-allowed"
              title="Next step"
            >
              <svg
                class="w-6 h-6 text-slate-700"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 5l7 7-7 7"
                ></path>
              </svg>
            </button>

            <!-- Last -->
            <button
              (click)="goToEnd()"
              [disabled]="(currentStepIndex$ | async) === steps.length - 1"
              class="p-2 bg-white border-2 border-slate-300 rounded-lg hover:bg-slate-50 transition-colors disabled:opacity-30 disabled:cursor-not-allowed"
              title="Last step"
            >
              <svg
                class="w-5 h-5 text-slate-700"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M13 5l7 7-7 7M5 5l7 7-7 7"
                ></path>
              </svg>
            </button>
          </div>

          <!-- Progress Bar -->
          <div class="bg-slate-200 rounded-full h-3 overflow-hidden">
            <div
              class="bg-gradient-to-r from-indigo-500 to-blue-500 h-full transition-all duration-300 ease-out"
              [style.width.%]="(((currentStepIndex$ | async)! + 1) / steps.length) * 100"
            ></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
